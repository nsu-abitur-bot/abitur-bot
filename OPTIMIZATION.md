# ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç–∞

## üöÄ –ß—Ç–æ –±—ã–ª–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

### 1. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã LLM**
- ‚úÖ `temperature`: 0.8 ‚Üí **0.7** (–±–æ–ª–µ–µ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã)
- ‚úÖ `timeout`: 120 ‚Üí **60** —Å–µ–∫—É–Ω–¥ (–±—ã—Å—Ç—Ä–µ–µ —Ñ–µ–π–ª–∏—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö)
- ‚úÖ `num_predict`: –Ω–µ –±—ã–ª–æ ‚Üí **256** —Ç–æ–∫–µ–Ω–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –æ—Ç–≤–µ—Ç–∞)
- ‚úÖ `top_k`: –Ω–µ –±—ã–ª–æ ‚Üí **40** (–±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã)
- ‚úÖ `top_p`: –Ω–µ –±—ã–ª–æ ‚Üí **0.9** (nucleus sampling)
- ‚úÖ `repeat_penalty`: –Ω–µ –±—ã–ª–æ ‚Üí **1.1** (–º–µ–Ω—å—à–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)

### 2. **–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç**
**–ë—ã–ª–æ:**
```
–¢–´ LLM –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ –ù–ì–£ (–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∏–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç), 
–æ—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–º –∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ–º. 
–û—Ç–≤–µ—á–∞–π –∫–æ—Ä–æ—Ç–∫–æ, –¥–æ–ª–≥–æ –Ω–µ –¥—É–º–∞–π
```

**–°—Ç–∞–ª–æ:**
```
–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ –ù–ì–£. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –ø–æ —Å—É—â–µ—Å—Ç–≤—É, –Ω–µ –±–æ–ª–µ–µ 3-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π. 
–ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ - —á–µ—Å—Ç–Ω–æ —Å–∫–∞–∂–∏ –æ–± —ç—Ç–æ–º.
```

### 3. **UX —É–ª—É—á—à–µ–Ω–∏—è**
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç..." –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `message.answer()` –≤–º–µ—Å—Ç–æ `bot.send_message()`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `[from username]`

---

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —É—Å–∫–æ—Ä–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –ª–µ–≥–∫—É—é –º–æ–¥–µ–ª—å (–ë–´–°–¢–†–ï–ï) ‚ö°‚ö°‚ö°

```bash
# –°–∫–∞—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å 1B (–≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ)
ollama pull llama3.2:1b

# –û–±–Ω–æ–≤–∏—Ç–µ .env
LLM_MODEL=llama3.2:1b
```

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏:**
| –ú–æ–¥–µ–ª—å | –†–∞–∑–º–µ—Ä | –°–∫–æ—Ä–æ—Å—Ç—å | –ö–∞—á–µ—Å—Ç–≤–æ |
|--------|--------|----------|----------|
| llama3.2:1b | 1.3 GB | ‚ö°‚ö°‚ö°‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê |
| llama3.2:3b | 2.0 GB | ‚ö°‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê |
| llama3.1:8b | 4.7 GB | ‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å

```bash
# –ú–æ–¥–µ–ª—å Gemma –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
ollama pull gemma2:2b

# –ò–ª–∏ Phi –¥–ª—è —á–∞—Ç-–±–æ—Ç–æ–≤
ollama pull phi3:mini
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Ollama –¥–ª—è GPU (–µ—Å–ª–∏ –µ—Å—Ç—å)

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Ollama –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å GPU acceleration:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ GPU
ollama run llama3.2:3b --verbose
```

### –í–∞—Ä–∏–∞–Ω—Ç 4: –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç Ollama

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å –∫—ç—à –¥–ª—è Ollama
export OLLAMA_CONTEXT_LENGTH=2048
ollama serve
```

---

## üìä –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á

### –î–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - —Å–∫–æ—Ä–æ—Å—Ç—å)
```bash
LLM_MODEL=llama3.2:1b
LLM_TEMPERATURE=0.5
LLM_NUM_PREDICT=128
```

### –î–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –∫–∞—á–µ—Å—Ç–≤–æ)
```bash
LLM_MODEL=llama3.2:3b
LLM_TEMPERATURE=0.7
LLM_NUM_PREDICT=512
```

### –î–ª—è –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
```bash
LLM_MODEL=llama3.2:3b
LLM_TEMPERATURE=0.9
LLM_NUM_PREDICT=256
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### `temperature` (0.0 - 2.0)
- **0.0-0.3**: –û—á–µ–Ω—å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã
- **0.4-0.7**: ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
- **0.8-1.2**: –ë–æ–ª–µ–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- **1.3-2.0**: –û—á–µ–Ω—å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ, –∏–Ω–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–Ω—ã–µ

### `num_predict` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤)
- **64-128**: –û—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- **128-256**: ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- **256-512**: –°—Ä–µ–¥–Ω–∏–µ –æ—Ç–≤–µ—Ç—ã (–∞–±–∑–∞—Ü)
- **512+**: –î–ª–∏–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–±–∑–∞—Ü–µ–≤)

### `top_k` (1-100)
- **10-20**: –û—á–µ–Ω—å —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- **30-50**: ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
- **50-100**: –ë–æ–ª–µ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

### `top_p` (0.0 - 1.0)
- **0.8-0.9**: ‚úÖ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- **0.9-0.95**: –ë–æ–ª–µ–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ
- **0.95-1.0**: –ú–∞–∫—Å–∏–º—É–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è

---

## üìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `test_settings.sh`:

```bash
#!/bin/bash

# –¢–µ—Å—Ç 1: –ë—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å
echo "LLM_MODEL=llama3.2:1b" > .env.test
./run.sh

# –¢–µ—Å—Ç 2: –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
echo "LLM_TEMPERATURE=0.5" >> .env.test
./run.sh

# –¢–µ—Å—Ç 3: –ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã
echo "LLM_NUM_PREDICT=128" >> .env.test
./run.sh
```

---

## üéì –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤**
```python
from functools import lru_cache

@lru_cache(maxsize=100)
def get_cached_response(question: str) -> str:
    # –ö—ç—à –¥–ª—è FAQ
    pass
```

### 2. **–î–æ–±–∞–≤—å—Ç–µ RAG –¥–ª—è —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤**
```python
from langchain.vectorstores import Chroma
from langchain.embeddings import OllamaEmbeddings

# –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ –ù–ì–£
vectorstore = Chroma(embedding_function=OllamaEmbeddings())
```

### 3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ streaming –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞**
```python
async for chunk in llm.astream(messages):
    await message.edit_text(accumulated_text + chunk.content)
```

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚ö° **–°–∫–æ—Ä–æ—Å—Ç—å**: 5-10 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ 15-30
- üìè **–î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞**: 2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- üéØ **–¢–æ—á–Ω–æ—Å—Ç—å**: –ë–æ–ª–µ–µ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- üí¨ **UX**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç..."

---

## üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞ (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
./run.sh
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ hot-reload (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):
```bash
pip install watchdog
watchmedo auto-restart --patterns="*.py" --recursive -- python bot/main.py
```
